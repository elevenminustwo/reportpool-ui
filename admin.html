<!DOCTYPE html>
<html lang="en">

<!--Test comment for push from Mert-->

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Admin Template</title>
  
  <!-- Jquery for datatable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  
  <!-- Bootstrap core CSS JS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  
  <!-- Custom CSS -->
  <link href="css/manager.css" rel="stylesheet">
  
  <!-- Datatable Css&Js -->
  <link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
  <link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

  <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
   
  <!-- Fontawesome cdn -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  
</head>
<body>
	<div class="container text-white">
	<h2>Bilgi Islem Daire Baskanligi Admin Ekrani</h2>
    <div class="panel">
		 <div class="panel-body">
		 <table id="dataTableId" class="table table-striped table-bordered" style="width:100%;">
            <thead>
                <tr>
					          <th>userid</th>
                    <th>Username</th>
                    <th>Name</th>
                    <th>Surname</th>
                    <th>Email</th>
					          <th>isActive</th>
					          <th>Role</th>
					          <th>Unit</th>
                </tr>
            </thead>
            <tbody>
			
            </tbody>
     </table>
	</div>
	
	
	
	</div>
	
	</div>

  <!-- Footer -->
  <footer class="footer text-center">
    <p class="copyright ">Copyright © 2019 Akdeniz Üniversitesi Tüm Hakları Saklıdır.</p>
  </footer>
  <div class="modal fade" id="roleModal" tabindex="-1" role="dialog" aria-labelledby="">
            <div class="modal-dialog modal-dialog-center">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h class="modal-title text-muted">Add Role Modal</h>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <form>
                        <div class="form-group m-3">
                                <label for="selectedrole">Select role:</label>
								<select class="form-control form-control-sm" id="selectedrole">
								<option value="1">Admin</option>
								<option value="2">Manager</option>
								<option value="3">User</option>
								</select>
                        </div>
                    </form>
                    <div class="modal-footer">
					<button class="btn btn-success" onclick="addRole()">
                            <i class="fa fa-plus" aria-hidden="true">Add</i>
                        </button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>

                </div>
            </div>

        </div>
		
	  <div class="modal fade" id="roledelModal" tabindex="-1" role="dialog" aria-labelledby="">
            <div class="modal-dialog modal-dialog-center">
                <div class="modal-content">
                    <div class="modal-header text-center">
                        <h class="modal-title text-muted">Delete Role Modal</h>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
					<form>
                        <div class="form-group m-3 text-center">
                                <label>Are you sure?</label>
                        </div>
                    </form>
                    <div class="modal-footer">
					<button class="btn btn btn-danger" onclick="delRole()">
                            <i class="fa fa-trash" aria-hidden="true">Del</i>
                        </button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>

                </div>
            </div>

        </div>
  <script>
        $(document).ready(function () {
            $("#dataTableId").DataTable({
                //jquery 1.10.16 da calisiyor sayfa routing i daha yeni surumlerinde o fonksiyon calismiyor.
                "processing": false, // for show progress bar
                "serverSide": true, // for process server side
                "aLengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]],
                "filter": true,
                "paging": true,
				
                "ajax": {
                    "url": "http://localhost:8080/api/getPersons",
                    //gelen jsondaki arrayi isaret etmeli dataSrc
                    "type": "POST",
					"dataSrc":"data",
					"error": function (request, status, error) {
        console.log(request);
    },
                },
                "columnDefs": [
					{
                        "targets": [0],
                        "visible": false,
                        "orderable": false,
                    },
                    {
                        "targets": [6],
                        "visible": true,
                        "orderable": true,
						"render": function ( data, type, row, meta ) {
							if(data!=null){
							return data +'</button><button type="submit" data-id="'+row[0]+'" class="open-roledelModal btn btn-sm btn-danger float-right ml-1"><i class="fa fa-trash" aria-hidden="true">Del</i></button>';
							}
							return '</button><button type="submit" data-id="'+row[0]+'" class="open-roleModal btn btn-sm btn-success float-right ml-1"><i class="fa fa-plus" aria-hidden="true">Add</i></button>';
					},
                    },
                    {
                        "targets": [7],
                        "visible": true,
                        "orderable": true,
						"render": function ( data, type, row, meta ) {
							if(data!=null){
							return data +'</button><button type="submit" class="btn btn-sm btn-danger float-right ml-1"><i class="fa fa-trash" aria-hidden="true">Del</i></button>';
							}
							return '</button><button type="submit" class="btn btn-sm btn-success float-right ml-1"><i class="fa fa-plus" aria-hidden="true">Add</i></button>';
					},
                    },
					
                    
                ],
				

                "pagingType": "full_numbers"
            });
			
        });
		var id="";
		function addRole() {
            var data = {
                userId: id,
                roleId: $("#selectedrole").val(),
            };
            $.ajax({
                type: "POST",
                url: "http://localhost:8080/api/addRole",
                data: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' },
                success: function(e){
				$('#dataTableId').DataTable().ajax.reload();
				$('#roleModal').modal('hide');

				},
            });
        }
		function delRole() {
            var data = {
                userId: id,
                roleId: $("#selectedrole").val(),
            };
            $.ajax({
                type: "POST",
                url: "http://localhost:8080/api/delRole",
                data: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' },
                success: function(e){
				$('#dataTableId').DataTable().ajax.reload();
				$('#roledelModal').modal('hide');

				},
            });
        }
		 $(document).on("click", ".open-roleModal", function () {
            id = $(this).data('id');
            $('#roleModal').modal('show');
            
        });
		 $(document).on("click", ".open-roledelModal", function () {
            id = $(this).data('id');
            $('#roledelModal').modal('show');
            
        });
    </script>
  
</body>
</html>